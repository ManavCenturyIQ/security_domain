<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"
    />
    <!-- Bootstrap CSS -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />

    <!-- Bootstrap JavaScript Bundle (Popper.js included) -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <title>Domain Check Results</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        margin: 0px;
        line-height: 1.6;
        background-color: #f9f9f9;
        color: #333;
      }
      .sidebar {
        /* width: 250px; */
        background: #2c3e50;
        color: white;
        padding: 15px;
        height: 100vh;
      }

      .sidebar div {
        display: flex;
        align-items: center;
        padding: 12px;
        cursor: pointer;
      }

      .sidebar a {
        display: flex;
        align-items: center;
        gap: 10px; /* This creates space between icon and text */
        text-decoration: none;
        color: white;
        width: 100%;
      }

      .sidebar div:hover {
        background: #34495e;
      }

      .dropdown {
        display: flex;
        align-items: center;
      }

      .dropdown-content {
        display: none;
        flex-direction: column;
        padding-left: 30px;
      }

      .dropdown-content a {
        padding: 8px 0;
        display: flex;
        align-items: center;
        gap: 10px;
        color: white;
        text-decoration: none;
      }

      .dropdown-content a:hover {
        background: #3b5998;
      }

      h1 {
        text-align: center;
        color: #444;
      }
      form {
        max-width: 600px;
        /* margin: 20px auto; */
        padding: 20px;
        /* background: #fff; */
        /* border-radius: 8px; */
        /* box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1); */
      }
      form .form-label {
        font-weight: bold;
        margin-bottom: 5px;
        display: block;
      }
      form .form-control {
        width: 100%;
        padding: 10px;
        margin-bottom: 10px;
        border: 1px solid #ddd;
        border-radius: 4px;
      }
      form .btn {
        background-color: #007bff;
        color: #fff;
        padding: 10px;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        width: 100%;
      }
      form .btn:hover {
        background-color: #0056b3;
      }
      table {
        width: 100%;
        border-collapse: collapse;
        margin: 20px 0;
        background-color: #fff;
        border-radius: 8px;
        overflow: hidden;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
      }
      th,
      td {
        padding: 12px 15px;
        text-align: left;
        border: 1px solid #ddd;
      }
      th {
        background-color: #007bff;
        color: white;
        font-weight: bold;
        text-transform: uppercase;
      }
      tr:nth-child(even) {
        background-color: #f2f2f2;
      }
      tr:hover {
        background-color: #d7ebf9;
      }
      .message {
        margin: 10px 0;
        padding: 10px;
        border: 1px solid #ddd;
        border-radius: 5px;
        background-color: #f4f4f4;
      }
      a {
        color: #007bff;
        text-decoration: none;
      }

      .btn-action {
        display: inline-block;
        padding: 5px 10px;
        font-size: 12px;
        border: none;
        border-radius: 3px;
        cursor: pointer;
        text-align: center;
        margin: 0 5px;
        transition: background-color 0.3s ease, color 0.3s ease;
      }

      .btn-safe {
        background-color: #28a745; /* Green for safe */
        color: white;
      }

      .btn-safe:hover {
        background-color: #218838;
      }

      .btn-malicious {
        background-color: #dc3545; /* Red for malicious */
        color: white;
      }

      .btn-malicious:hover {
        background-color: #c82333;
      }

      .btn-action i {
        margin-right: 5px; /* Small space between icon and text */
        font-style: normal; /* Prevents italicization */
      }
    </style>
  </head>
  <body>
    <!-- <h1>Domain Check Results</h1> -->

    <div style="display: flex">
      <div class="sidebar">
        <h5>DOMAIN CHECK</h5>
        <div>
          <a href="list_of_domains"><i class="fa-solid fa-house"></i>Home</a>
        </div>
  <div class="dropdown-one" style="flex-direction: column;" onclick="toggleDomainDropdown()">
  <a><i class="fas fa-shield-alt"></i>Domain Check</a>
  
  </div>
  <div id="dropdownContent1" class="dropdown-content" style="display: none">
  
        <!-- <div>
          <a href="list_of_domains"><i class="fa-solid fa-chart-line"></i> Dashboard</a>
        </div> -->
        <div>
          <a href="domain_check"><i class="fas fa-key"></i> Check Keywords</a>
        </div>
        <div class="dropdown" onclick="toggleDomainDropdown1()">
          <a><i class="fas fa-globe"></i> Domain Details</a>
        </div>
        <div
          class="dropdown-content1"
          id="dropdownContent12"
          style="display: none"
        >
          <a href="{{ url_for('safe_page') }}">Safe Domains</a>
          <a href="{{ url_for('malicious_page') }}">Malicious Domains</a>
          <a href="{{ url_for('manual_takedown') }}">Manual Take Down</a>
        </div>
  
        <div class="dropdown" onclick="toggleAccountDropdown2()">
          <a><i class="fas fa-folder"></i> Account Pages</a>
        </div>
        <div
          class="dropdown-content2"
          id="dropdownContent13"
          style="display: none"
        >
          <a href="{{ url_for('login') }}"
            ><i class="fas fa-sign-in-alt"></i> Login</a
          >
          <a href="{{ url_for('signup') }}"
            ><i class="fas fa-user-plus"></i> Sign In</a
          >
          <a href="{{ url_for('forgot_password') }}"
            ><i class="fas fa-lock"></i> Forget Password</a
          >
        </div>
      </div>
      <div class="dropdown-one" style="flex-direction: column;" onclick="toggleDomainDropdownInventory()">
        <a><i class="fas fa-server"></i>Domain Inventory</a>
    </div>
    <div>
        <div id="dropdownContentKeywords" class="dropdown-content" style="display: none">
            <a href="owned_domains"><i class="fas fa-key"></i> Owned Domains</a>
        </div>
    </div>
      <div>
       
      </div>
      </div>
      <!-- <div class="col-6" style="justify-content: flex-start">
      <a href="{{ url_for('list_of_domains') }}" class="btn">Dashboard</a>
    </div>
    <a href="{{ url_for('logout') }}" class="btn btn-danger">Logout</a> -->
      <div class="col-10">
        <div style="margin: 0 auto">
          <form
            method="POST"
            enctype="multipart/form-data"
            class="mb-4"
            onsubmit="return validateForm()"
          >
            <div class="mb-3">
              <label for="keyword" class="form-label">Enter Keyword</label>
              <input
                type="text"
                name="keyword"
                id="keyword"
                class="form-control"
                placeholder="e.g. example"
                required
              />
              <div
                id="keywordError"
                class="text-danger mt-2"
                style="display: none"
              >
                Please enter a valid keyword.
              </div>
            </div>
            <button type="submit" class="btn">Search</button>
          </form>

          {% with messages = get_flashed_messages(with_categories=true) %} {% if
          messages %} {% for category, message in messages %}
          <!-- <div class="{{ category }} message">{{ message }}</div> -->
          {% endfor %} {% endif %} {% endwith %} {% if results %} {% for result
          in results %}
          <h3>Results for: {{ result.keyword }}</h3>
          <table class="table">
            <thead>
              <tr style="font-size: 12px">
                <th>Domain</th>
                <th>Zone</th>
                <th>Host</th>
                <th>Subdomain</th>
                <th>Register URL</th>
                <th>Safety Status</th>
                <th>Message</th>
                <th>Category</th>
                <th>Actions</th>
                <th>Email Status</th>
                <!-- <th>Screenshot</th> -->
              </tr>
            </thead>
            <tbody style="font-size: 14px">
              {% for result in results %} {% for domain in result.results %}
              <tr style="font-size: 11px">
                <td>{{ domain.domain }}</td>
                <td>{{ domain.zone }}</td>
                <td>{{ domain.host }}</td>
                <td>{{ domain.subdomain }}</td>
                <td>
                  <a href="{{ domain.registerURL }}" target="_blank"
                    >Register</a
                  >
                </td>
                <td>{{ domain.safety_status }}</td>
                <td>{{ domain.message }}</td>
                <td>{{ domain.category }}</td>

                <td>
                  <button
                    class="btn-action btn-safe"
                    onclick="flagAsSafe('{{ domain.domain }}')"
                  >
                    Flag as Safe
                  </button>
                  <button
                    class="btn-action btn-malicious"
                    onclick="flagAsMalicious('{{ domain.domain }}')"
                  >
                    Flag as Malicious
                  </button>
                  <button
                    class="btn-action btn-primary"
                    onclick="sendEmailTakedown('{{ domain.domain }}')"
                  >
                    Send Email
                  </button>
                </td>
                <td id="email-status-{{ domain.domain }}">
                  {% if domain.email_sent %} Email Sent {% else %} Not Sent {%
                  endif %}
                </td>
                <!-- <td>
                  {% if domain.screenshot_url %}
                  <img
                    src="{{ domain.screenshot_url }}"
                    alt="Screenshot"
                    width="100"
                  />
                  {% else %} No screenshot available {% endif %}
                </td> -->
              </tr>
              {% endfor %} {% endfor %}
            </tbody>
          </table>
          {% endfor %} {% else %}
          <!-- <p>No results to display.</p> -->
          {% endif %}

          <!-- <a href="{{ url_for('domain_check') }}">Check Another Domain</a> -->
        </div>
      </div>
    </div>
  </body>
  <script>
    function flagAsSafe(domain) {
      fetch("/mark_as_safe", {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
        },
        body: JSON.stringify({ domain: domain }),
      })
        .then((response) => {
          if (!response.ok) {
            return response.json().then((data) => {
              throw new Error(data.message);
            });
          }
          return response.json();
        })
        .then((data) => {
          alert(data.message);
          document.getElementById(`marked-as-${domain}`).textContent = "Safe";
        })
        .catch((error) => {
          console.error("Error:", error);
          alert("An error occurred: " + error.message);
        });
    }

    function flagAsMalicious(domain) {
      fetch("/mark_as_malicious", {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
        },
        body: JSON.stringify({ domain: domain }),
      })
        .then((response) => {
          if (!response.ok) {
            return response.json().then((data) => {
              throw new Error(data.message);
            });
          }
          return response.json();
        })
        .then((data) => {
          alert(data.message);
          document.getElementById(`marked-as-${domain}`).textContent =
            "Malicious";
        })
        .catch((error) => {
          console.error("Error:", error);
          alert("An error occurred: " + error.message);
        });
    }
  </script>
  <script>
    function sendEmailTakedown(domain) {
      fetch("/send_email_takedown", {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
        },
        body: JSON.stringify({ domain: domain }),
      })
        .then((response) => response.json())
        .then((data) => {
          if (data.message.includes("Email sent")) {
            document.getElementById(`email-status-${domain}`).innerText =
              "Email Sent";
          } else if (
            data.message.includes("Moved to manual takedown collection")
          ) {
            alert(data.message);
          } else {
            alert(data.message);
          }
        })
        .catch((error) => console.error("Error:", error));
    }
  </script>
  <script>
    // Check if the email variable is None and log a debug message
    document.addEventListener("DOMContentLoaded", function () {
      const userEmail = "{{ email }}";
      if (!userEmail || userEmail === "None") {
        console.debug("Debug: Email is not present or is None.");
      } else {
        console.debug("Debug: Email is present:", userEmail);
      }
    });
  </script>
  <script>
    // Function to toggle the visibility of the dropdown menu
    function toggleUserDropdown() {
      const dropdown = document.querySelector(".dropdown-user");
      if (dropdown.style.display === "block") {
        dropdown.style.display = "none";
      } else {
        dropdown.style.display = "block";
      }
    }

    // Add an event listener to the user dropdown toggle link
    document
      .querySelector("#userDropdown")
      .addEventListener("click", function (event) {
        event.preventDefault(); // Prevent the default anchor click behavior
        toggleUserDropdown(); // Toggle the dropdown visibility
      });
  </script>
  <script>
    function toggleDropdown(id) {
      var dropdown = document.getElementById(id);
      dropdown.style.display =
        dropdown.style.display === "block" ? "none" : "block";
    }
  </script>
  <script>
    function toggleDomainDropdown() {
      var dropdown = document.getElementById("dropdownContent1");
      if (dropdown.style.display === "block") {
        dropdown.style.display = "none";
      } else {
        dropdown.style.display = "block";
      }
    }

    function toggleAccountDropdown() {
      var dropdown = document.getElementById("dropdownContent2");
      if (dropdown.style.display === "block") {
        dropdown.style.display = "none";
      } else {
        dropdown.style.display = "block";
      }
    }
  </script>
  <script>
    function toggleDomainDropdownInventory() {
      var dropdown = document.getElementById("dropdownContentKeywords");
      if (dropdown.style.display === "block") {
        dropdown.style.display = "none";
      } else {
        dropdown.style.display = "block";
      }
    }
  </script>
</html>
